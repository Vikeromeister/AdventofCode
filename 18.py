input = """[[8,8],5]
[[[[9,0],1],4],[[3,6],[0,5]]]
[[9,[0,[4,5]]],[1,[[6,8],4]]]
[[8,7],[[[8,5],[2,0]],[[6,3],[5,0]]]]
[[[1,8],2],[[[9,1],[2,0]],[1,[9,4]]]]
[[[6,[8,8]],[6,4]],[[8,2],[[0,8],9]]]
[[[6,3],[9,[9,1]]],[[0,0],1]]
[[[[2,7],[8,2]],[[9,6],[5,1]]],[[[7,6],[6,0]],[4,2]]]
[[[8,[9,1]],[9,3]],[[[5,4],[8,0]],[[3,5],[9,5]]]]
[[[3,[4,9]],2],[[7,9],7]]
[[[7,[9,0]],5],[[[3,4],[2,6]],[[3,5],[7,2]]]]
[[8,[8,9]],[[[3,2],[6,2]],4]]
[[[[8,0],3],[3,8]],[[[5,0],[7,3]],[5,[3,0]]]]
[4,[[3,[0,9]],[[5,0],[2,0]]]]
[[[[0,1],5],[3,[9,6]]],[[[4,4],5],[[3,8],[5,1]]]]
[[[[4,8],8],0],[5,[[1,7],[4,3]]]]
[[3,[[1,1],[5,6]]],[7,[[4,0],[0,7]]]]
[9,[4,[[1,3],2]]]
[[[1,[2,7]],[[4,7],3]],[2,1]]
[[[9,5],[2,5]],[[[8,9],[4,5]],2]]
[[2,[[7,4],6]],[[1,[0,7]],[[4,8],8]]]
[[[[0,5],3],[7,0]],9]
[[[[1,4],[4,3]],7],[[9,4],[6,[8,6]]]]
[[[7,2],[[3,3],1]],[5,9]]
[[[9,[6,2]],2],[[6,5],6]]
[[5,[3,2]],[[[2,4],[1,5]],[6,3]]]
[6,3]
[[9,6],[[[8,2],[5,6]],[[3,5],[3,3]]]]
[[[[2,5],7],4],[8,3]]
[[[[6,1],9],[0,6]],[6,2]]
[[[[8,4],2],[[0,1],[5,8]]],9]
[[[7,0],[4,9]],[[[9,9],[4,4]],[6,6]]]
[[[9,8],[2,0]],[[9,[6,2]],[6,[5,6]]]]
[[[9,8],[[0,6],[3,5]]],[[[4,7],[7,5]],[7,[8,5]]]]
[[[[9,0],[1,6]],[2,[5,3]]],[[[2,0],[0,3]],[[9,1],[7,7]]]]
[[[5,[2,2]],[2,[1,0]]],[1,1]]
[[[9,[7,2]],[[2,7],1]],[[5,7],[[8,7],7]]]
[[[9,[9,4]],[[0,8],2]],[0,[[2,2],[4,1]]]]
[[[5,5],[9,[2,0]]],[[[9,0],6],1]]
[[[1,9],[[9,5],[5,6]]],[6,[5,[9,4]]]]
[[[[8,6],9],9],[[7,2],[7,[2,6]]]]
[[[[6,4],7],7],[[2,[9,7]],7]]
[[7,[[5,6],9]],[[[9,8],8],[[8,9],[1,0]]]]
[[[0,[7,6]],0],[[[2,5],1],9]]
[[[3,[4,1]],[4,2]],[0,[[6,0],[1,6]]]]
[[9,[0,0]],[[[3,0],[9,9]],[1,[1,5]]]]
[[[[9,9],1],6],[5,6]]
[3,4]
[[[[5,4],9],6],2]
[[5,4],[[6,[7,4]],[[0,3],0]]]
[[[3,[9,6]],4],[[[9,8],6],3]]
[[5,[1,[5,5]]],[[[3,8],[0,1]],[[9,3],[6,2]]]]
[[4,[0,3]],1]
[[[7,[2,9]],[[5,8],2]],[[[4,4],[2,0]],8]]
[[[[4,0],0],8],7]
[[[[3,0],0],[[6,0],3]],[[[1,5],1],[3,[0,0]]]]
[[[[8,1],5],0],[[[3,9],[8,3]],[[6,9],[5,1]]]]
[[7,7],[[[8,5],2],[9,2]]]
[[[[4,9],9],[6,[5,3]]],[[[7,1],[7,1]],[[9,5],[7,0]]]]
[[7,[0,5]],[7,[2,[1,6]]]]
[[9,[0,[0,2]]],[[1,1],[[6,6],[5,3]]]]
[[[2,9],[[6,9],9]],[[[4,2],7],[1,[2,3]]]]
[[[0,1],[3,3]],[3,[[2,7],2]]]
[[[5,6],8],[[[4,9],[3,3]],[6,[5,2]]]]
[[4,[4,[2,5]]],[[2,[4,8]],[3,[7,7]]]]
[[2,5],[[[9,6],[9,3]],[[4,5],[2,3]]]]
[[5,[0,5]],[[[2,1],[0,5]],3]]
[[[[2,0],5],[[7,9],[4,5]]],[0,[[1,4],9]]]
[[[[1,3],2],[[3,9],[9,5]]],[[[4,1],[3,8]],0]]
[[[[1,8],[8,3]],[3,0]],[[5,1],[4,8]]]
[[1,6],[3,2]]
[[4,5],[[[9,3],[8,6]],[2,[8,6]]]]
[[[[4,4],1],[[7,3],2]],[[9,[2,1]],[8,2]]]
[0,[[2,[3,8]],9]]
[[1,[5,0]],[0,[[2,6],[8,5]]]]
[[6,[6,1]],[[2,[7,9]],[[8,3],1]]]
[[[2,[5,9]],[[8,9],1]],[[[5,2],2],4]]
[[[4,3],5],[[6,[3,6]],5]]
[1,[6,[6,2]]]
[[[[4,9],3],9],[[3,9],[8,[4,9]]]]
[[[[7,1],[1,6]],[[7,8],[3,7]]],[[[5,3],7],[9,[3,1]]]]
[[[[0,8],[8,9]],2],7]
[[[[3,7],[9,8]],[[7,1],8]],[[4,[4,6]],8]]
[3,[3,[[4,4],5]]]
[[3,[[2,3],7]],[[7,9],2]]
[[[[0,6],[5,1]],[[7,2],5]],[9,8]]
[[4,0],[[4,3],[7,2]]]
[[[8,[1,1]],[7,[9,1]]],[9,[9,[0,8]]]]
[9,[[[4,5],8],[[3,4],9]]]
[[[6,[4,7]],[8,7]],[[[3,8],5],[[2,1],[3,5]]]]
[[[[5,5],[6,8]],[[2,3],6]],[8,[5,7]]]
[[5,[[6,1],[3,6]]],[[[0,6],[7,1]],[9,[8,4]]]]
[[[[0,1],[4,9]],[[1,7],[3,3]]],[6,[3,[6,1]]]]
[[[[3,8],5],[[4,7],2]],2]
[[6,[[4,4],0]],[[2,[4,5]],[8,2]]]
[[6,[9,[7,0]]],[[9,[1,6]],[[6,1],1]]]
[[[[2,1],[5,7]],[5,[9,3]]],[[[7,9],[4,2]],4]]
[[3,1],[[7,8],[[8,8],9]]]
[[[[9,4],[1,8]],[9,[3,7]]],[[6,9],[[7,2],1]]]
[[[9,3],2],9]""".splitlines()

# input = """[[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]]
# [[[5,[2,8]],4],[5,[[9,9],0]]]
# [6,[[[6,2],[5,6]],[[7,6],[4,7]]]]
# [[[6,[0,7]],[0,9]],[4,[9,[9,0]]]]
# [[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]]
# [[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]]
# [[[[5,4],[7,7]],8],[[8,3],8]]
# [[9,3],[[9,9],[6,[4,9]]]]
# [[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]]
# [[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]""".splitlines()

from treelib import Node, Tree
from math import floor, ceil


def print_tree():
    string = ""
    global tree
    currentParent = tree.root
    for node in tree.expand_tree(mode=tree.DEPTH, sorting=False):
        # print(string)


        if node != 0:
            while not tree.is_ancestor(currentParent, node):
                string += "]"
                currentParent = tree.parent(currentParent).identifier
        try:
            if tree.children(tree.parent(node).identifier)[1].identifier == node:
                string += ","
        except:
            pass
        if tree.depth(node) > tree.depth(currentParent) + 1:
            string += "[" * (tree.depth(node) - tree.depth(currentParent) - 1)
            currentParent = tree.parent(node).identifier
        if tree[node].is_leaf():
            string += str(tree[node].data)
        # if tree.depth(node) < :
        #     string += "]"
        level = tree.depth(node)
    print(string)


def magnitude():
    global tree
    for i in range(6):
        for node in tree.expand_tree(sorting=False):
            if not tree[node].is_leaf():
                tree[node].data = 0
                tree[node].data += tree.children(node)[0].data * 3 + tree.children(node)[1].data * 2
    return tree[tree.root].data



tree = Tree()
tree.create_node(0, 0, data=0)
currentNode = tree[0]
i = 1
first = True
# for char in input[0]:
#     if char == "[":
#         if first:
#             first = False
#             continue
#         # try:
#         tree.create_node(i, i, parent=currentNode.identifier, data=0)
#         # except:
#         #     tree.create_node(i, i)
#         currentNode = tree[i]
#         i += 1
#     elif char == ",":
#         pass
#     elif char == "]":
#         currentNode = tree.parent(currentNode.identifier)
#     elif char in "0123456789":
#         tree.create_node(i, i, parent=currentNode.identifier, data=int(char))
#         i += 1
#     else:
#         print("WTF is that")
# # print_tree()
# # tree.show()
# for [k, line] in enumerate(input[1:]):
#     print(k)
#     first = True
#     tree.create_node(i, i, parent=tree[tree.root], data=0)
#     for node in tree.children(tree.root):
#         if node.identifier != i:
#             # print("moving node", node.identifier, "to", i)
#             tree.move_node(node.identifier, i)
#             # print_tree()
#     i += 1
#     tree.create_node(i, i, parent=tree[tree.root], data=0)
#     currentNode = tree[i]
#     i += 1
#     for char in line:
#         if char == "[":
#             if first:
#                 first = False
#                 continue
#             # try:
#             tree.create_node(i, i, parent=currentNode.identifier, data=0)
#             # except:
#             #     tree.create_node(i, i)
#             currentNode = tree[i]
#             i += 1
#         elif char == ",":
#             pass
#         elif char == "]":
#             currentNode = tree.parent(currentNode.identifier)
#         elif char in "0123456789":
#             tree.create_node(i, i, parent=currentNode.identifier, data=int(char))
#             i += 1
#         else:
#             print("WTF is that")
#     # time to reduce
#     exploded = True
#     print_tree()
#     while exploded or split:
#         exploded = False
#         split = False
#         # print_tree()
#         # print("")
#         for node in tree.expand_tree(mode=tree.DEPTH, sorting=False):  # explosions
#             if tree.depth(node) > 4 and tree[node].is_leaf():
#                 # print("exploded", tree[node].data, tree.siblings(node)[0].data)
#                 nextone = False
#                 lastone = None
#                 for secondnode in tree.expand_tree(sorting=False):
#                     if secondnode == node and lastone:
#                         tree[lastone].data += tree[node].data
#                         break
#                     if tree[secondnode].is_leaf():
#                         lastone = secondnode
#                 for secondnode in tree.expand_tree(sorting=False):
#                     if nextone and tree[secondnode].is_leaf():
#                         tree[secondnode].data += tree.siblings(node)[0].data
#                         break
#                     if secondnode == tree.siblings(node)[0].identifier:
#                         nextone = True
#
#                 exploded = True
#                 daddy = tree.parent(node).identifier
#                 tree.remove_node(tree.siblings(node)[0].identifier)
#                 tree.remove_node(tree[node].identifier)
#                 print_tree()
#                 # print(daddy)
#                 tree.nodes[daddy].data = 0
#                 # i += 1
#                 break
#         if exploded:
#             continue
#         for node in tree.expand_tree(mode=tree.DEPTH, sorting=False):  # splits
#             if tree[node].is_leaf():
#                 if tree[node].data > 9:
#                     split = True
#                     # print("split", tree[node].data)
#                     tree.create_node(i, i, parent=node)
#                     tree[i].data = floor(tree[node].data / 2)
#                     i += 1
#                     tree.create_node(i, i, parent=node)
#                     tree[i].data = ceil(tree[node].data / 2)
#                     i += 1
#                     tree.parent(node).data = -1
#                     print_tree()
#                     break

# print(tree.depth())
print_tree()
print(magnitude())

max_mag = 0
for [k, lineone] in enumerate(input):
    for linetwo in input:
        tree = Tree()
        tree.create_node(0, 0, data=0)
        currentNode = tree[0]
        i = 1
        first = True
        for char in lineone:
            if char == "[":
                if first:
                    first = False
                    continue
                # try:
                tree.create_node(i, i, parent=currentNode.identifier, data=0)
                # except:
                #     tree.create_node(i, i)
                currentNode = tree[i]
                i += 1
            elif char == ",":
                pass
            elif char == "]":
                currentNode = tree.parent(currentNode.identifier)
            elif char in "0123456789":
                tree.create_node(i, i, parent=currentNode.identifier, data=int(char))
                i += 1
            else:
                print("WTF is that")
        # print_tree()
        # tree.show()
        # print(k)
        first = True
        tree.create_node(i, i, parent=tree[tree.root], data=0)
        for node in tree.children(tree.root):
            if node.identifier != i:
                # print("moving node", node.identifier, "to", i)
                tree.move_node(node.identifier, i)
                # print_tree()
        i += 1
        tree.create_node(i, i, parent=tree[tree.root], data=0)
        currentNode = tree[i]
        i += 1
        for char in linetwo:
            if char == "[":
                if first:
                    first = False
                    continue
                # try:
                tree.create_node(i, i, parent=currentNode.identifier, data=0)
                # except:
                #     tree.create_node(i, i)
                currentNode = tree[i]
                i += 1
            elif char == ",":
                pass
            elif char == "]":
                currentNode = tree.parent(currentNode.identifier)
            elif char in "0123456789":
                tree.create_node(i, i, parent=currentNode.identifier, data=int(char))
                i += 1
            else:
                print("WTF is that")
        # time to reduce
        exploded = True
        # print_tree()
        while exploded or split:
            exploded = False
            split = False
            # print_tree()
            # print("")
            for node in tree.expand_tree(mode=tree.DEPTH, sorting=False):  # explosions
                if tree.depth(node) > 4 and tree[node].is_leaf():
                    # print("exploded", tree[node].data, tree.siblings(node)[0].data)
                    nextone = False
                    lastone = None
                    for secondnode in tree.expand_tree(sorting=False):
                        if secondnode == node and lastone:
                            tree[lastone].data += tree[node].data
                            break
                        if tree[secondnode].is_leaf():
                            lastone = secondnode
                    for secondnode in tree.expand_tree(sorting=False):
                        if nextone and tree[secondnode].is_leaf():
                            tree[secondnode].data += tree.siblings(node)[0].data
                            break
                        if secondnode == tree.siblings(node)[0].identifier:
                            nextone = True

                    exploded = True
                    daddy = tree.parent(node).identifier
                    tree.remove_node(tree.siblings(node)[0].identifier)
                    tree.remove_node(tree[node].identifier)
                    # print_tree()
                    # print(daddy)
                    tree.nodes[daddy].data = 0
                    # i += 1
                    break
            if exploded:
                continue
            for node in tree.expand_tree(mode=tree.DEPTH, sorting=False):  # splits
                if tree[node].is_leaf():
                    if tree[node].data > 9:
                        split = True
                        # print("split", tree[node].data)
                        tree.create_node(i, i, parent=node)
                        tree[i].data = floor(tree[node].data / 2)
                        i += 1
                        tree.create_node(i, i, parent=node)
                        tree[i].data = ceil(tree[node].data / 2)
                        i += 1
                        tree.parent(node).data = -1
                        # print_tree()
                        break
        max_mag = max(max_mag, magnitude())
    print(k, max_mag)


